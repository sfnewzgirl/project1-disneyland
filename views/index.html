<!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">

      <title>Disneyland ProTips</title>

      <!-- STYLESHEETS -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
      <link rel="stylesheet" href="/styles/styles.css">
      <link rel="stylesheet" href="/styles/finalStyles.css">

      <!-- VENDOR SCRIPTS -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>

      <!-- APPLICATION SCRIPTS -->
      <script src="/scripts/app.js"></script>
      <script src="/scripts/nod.js"></script>

    </head>
  <body>
    <script>
      // callback function
      function statusChangeCallback(response) {
        if (response.status === 'connected') {
          // Logged into your app and Facebook.
          testAPI();
        } else if (response.status === 'not_authorized') {
          // The person is logged into Facebook, but not your app.
          document.getElementById('status').innerHTML = 'Please log ' +
            'into this app.';
        } else {
          // The person is not logged into Facebook, so we're not sure if
          // they are logged into this app or not.
          document.getElementById('status').innerHTML = 'Please log ' +
            'into Facebook.';
        }
      }

      function checkLoginState() {
         FB.getLoginStatus(function(response) {
           statusChangeCallback(response);
         });
       }

      // initializes facebook login
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '120357998436314',
          cookie     : true,  // enable cookies to allow the server to access
                              // the session
          xfbml      : true,  // parse social plugins on this page
          version    : 'v2.5' // use graph api version 2.5
        });

        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });

      };

      // Load the SDK asynchronously
      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

      function testAPI() {
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me', function(response) {
          console.log('Successful login for: ' + response.name);
          document.getElementById('status').innerHTML =
            'Thanks for logging in, ' + response.name + '!';
        });
      }
    </script>

   <!-- facebook login button -->
    <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
    </fb:login-button>

    <div id="status"></div>

    <!-- add a new protip form -->
    <h1 class="proTipText">  ProTips : Your Source From People That Know  </h1>
    <div class="container-fluid">
      <div class="row">
        <div class=".col-md-6">
          <h2> Add a new <span id="disney">Disney</span> ProTip! </h2>
            <form class="form-horizontal" id="newProTipForm" data-id="{{_id}}">
              <label for="ProTipTitle">Title</label>
              <input type="text" class="form-control" name="tipTitle" id="ProTipTitle" placeholder="Give your ProTip a title.">
              <label for="ProTipDescription">What is your ProTip?</label>
              <textarea class="form-control" name="tipDescription" id="ProTipDescription" rows="3" placeholder="In a few lines, describe your tip."></textarea>
              <button type="submit" class="btn btn-primary" id="SubmitProTip">Submit ProTip</button>
            </form>
          <hr>
        </div>
      </div>
    </div>
    <!-- one protip section -->
    <div id='voteWrapper' class="protipList container-fluid">
      <div class="row">
        <script id='voteTile' type="text/x-handlebars-template">
          {{#each proTipVote}}
            <div class = "proTipTile">
              <div class="col-md-8 col-md-push-1 proTipBg">
                <span class="commentTitle">{{tipTitle}}</span>
                <br>
                <span class="commentDescription">{{tipDescription}}</span>
                <br>
                <button type="button" class="btn btn-danger" data-id={{_id}}>Delete ProTip</button>
                <button type="button" name="commentButton" class="btn btn-default comment-button" data-protip-id={{_id}}>Add a comment</button>
              </div>
                <div class="col-md-1 col-md-pull-8 btn-group-vote">
                  <div class="vote circle">
                    <div class="increment up upbutton" data-id={{_id}}></div>
                    <div class="increment down downbutton" data-id={{_id}}></div>
                    <div class="count">{{tipScore}}</div>
                </div>
              </div>
            </div>
            <br>
              <form class="form-create-comment" id="commentForm{{_id}}" data-protip-id={{_id}}>
                <div class="form-group comment-form">
                  <label for="comment-text-area"></label>
                  <textarea class="form-control comment-body" rows="4" placeholder="Have anything to add?"></textarea>
                  <button type="submit" name="submitCommentButton" class="btn btn-default submit-comment-button" data-protip-id={{_id}}>submit</button>
                </div>
              </form>
              <br>
                <div class="col-md-8 commentContainer">
                  <label for="comment-text-area">Comments for this ProTip</label>
                    <ul>
                        {{#each tipComment}}
                        <li class="comment-list commentBg">
                          {{commentBody}}
                        </li>
                        {{/each}}
                    </ul>
                </div>
          {{/each}}
        </script>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    nodInit();
  </script>
</html>
